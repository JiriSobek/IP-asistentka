<!DOCTYPE html>
<html lang="cs">
<head>
  <style>
    body { font-family: system-ui, sans-serif; font-size:16px; line-height:1.5; padding:20px }
    textarea { width:725px; height:200px; border:1px solid #ccc; border-radius:12px; padding:10px; resize:vertical; font:inherit }
    button { background:#e76a58; color:#fff; border:none; padding:10px 20px; margin:5px; cursor:pointer; border-radius:999px; font-size:1rem }
    #result { margin-top:20px }
  </style>
</head>
<body>

  <textarea id="editor" placeholder="Sem napiš text…"></textarea><br>
  <button id="btnAdvice">Poradit</button>
  <button id="btnImprove">Vylepšit</button>
  <button id="btnUndo" disabled>Zpět</button>
  <button id="btnCopy">Kopírovat</button>
  <div id="result"></div>

  <script>
    const editor = document.getElementById("editor"),
          result = document.getElementById("result"),
          btnAdvice = document.getElementById("btnAdvice"),
          btnImprove = document.getElementById("btnImprove"),
          btnUndo = document.getElementById("btnUndo"),
          btnCopy = document.getElementById("btnCopy");
    let before;

    // funkce pro SSE stream
    async function callApi(path, payload) {
      result.innerHTML = "<b>Moment, přemýšlím…</b>";
      const res = await fetch(path, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const reader = res.body.getReader();
      const dec    = new TextDecoder();
      let done=false;
      result.innerHTML=""; 
      while(!done) {
        const { value, done: d } = await reader.read();
        done = d;
        if(value) {
          const chunk = dec.decode(value, { stream:true });
          result.innerHTML += chunk;
        }
      }
    }

    btnAdvice.onclick = async () => {
      const txt = editor.value.trim();
      if(!txt) return alert("Napiš nejdřív text.");
      await callApi("/api/advice", { text: txt });
    };

    btnImprove.onclick = async () => {
      const txt = editor.value.trim();
      if(!txt) return alert("Napiš nejdřív text.");
      before = txt;
      btnUndo.disabled = false;
      const improved = await callApi("/api/improve", { text: txt });
      // u improve by se stream mohl vracet full text, ale pro jednoduchost můžeme i zde
      editor.value = improved;
      result.innerHTML = "";
    };

    btnUndo.onclick = () => {
      editor.value = before;
      result.innerHTML = "";
      btnUndo.disabled = true;
    };

    btnCopy.onclick = () => {
      const txt = editor.value.trim();
      if(!txt) return;
      navigator.clipboard.writeText(txt)
        .then(()=>{ btnCopy.textContent="Zkopírováno ✓"; setTimeout(()=>btnCopy.textContent="Kopírovat",2000) })
        .catch(()=>{/* ignore */});
    };
  </script>
</body>
</html>
